---
- name: Configure SSH Port
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?Port\s+'
    line: "Port {{ ssh_port }}"
    validate: '/usr/sbin/sshd -t -f %s'
  notify: Restart SSH

- name: Configure PermitRootLogin
  lineinfile:
    path: /etc/ssh/sshd_config
    regexp: '^#?PermitRootLogin\s+'
    line: "PermitRootLogin {{ ssh_permit_root_login }}"
    validate: '/usr/sbin/sshd -t -f %s'
  notify: Restart SSH

- name: Stop and Disable ssh.socket (if present)
  service:
    name: ssh.socket
    state: stopped
    enabled: no
  ignore_errors: yes